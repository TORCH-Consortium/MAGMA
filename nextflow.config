manifest {
    name = 'XBS-nf'
    description = 'XBS-nf (compleX Bacterial Samples) is a pipeline for comprehensive genomic analyses of Mycobacterium tuberculosis with a focus on clinical decision making as well as research.'
    version = '0.9.8'
    author = 'TORCH-Consortium'
    defaultBranch = 'master'
    homePage = 'https://github.com/TORCH-Consortium/magma'
}

params { includeConfig 'default_params.config' }

process {

    cpus = 4
    memory = 4.GB

    withName: 'QUANTTB_QUANT' {
        cpus = 2
        memory = 30.GB
        // maxForks = 1
    }

    withName: 'FASTQC' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'UTILS_QUANTTB_.*' {
        cpus = 1
        memory = 2.GB
    }

    withName: 'BWA_MEM' {
        cpus = 8
        memory = 8.GB
    }

    withName: 'SAMTOOLS_MERGE' {
        cpus = 4
        memory = 2.GB
    }

    withName: 'MULTIQC' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'GATK_MARK_DUPLICATES' {
        cpus = 2
        memory = 16.GB
    }

    withName: 'GATK_BASE_RECALIBRATOR' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'GATK_APPLY_BQSR' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'LOFREQ_INDELQUAL' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'GATK_FLAG_STAT' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'GATK_COLLECT_WGS_METRICS' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'SAMTOOLS_STATS' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'SAMTOOLS_INDEX.*' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'DELLY_CALL' {
        cpus = 2
        memory = 2.GB
    }

    withName: 'GATK_HAPLOTYPE_CALLER.*' {
        cpus = 2
        memory = 4.GB
    }

    withName: 'LOFREQ_CALL.*' {
        cpus = 8
        memory = 2.GB
    }

    withName: 'BGZIP' {
        cpus = 1
        memory = 2.GB
    }

}


profiles {

    // Package management specific settings
    conda_local { includeConfig 'conf/conda_local.config' }
    docker { includeConfig 'conf/docker.config' }

    // Executor specific settings
    pbs { includeConfig 'conf/pbs.config' }
    server { includeConfig 'conf/server.config' }

    //NOTE: Test profile - DO NOT USE
    test { includeConfig 'conf/test.config' }
}

